<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CTL Warranty Analysis Dashboard - 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e4e4e4;
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #4fc3f7;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .subtitle {
            text-align: center;
            color: #90a4ae;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }
        
        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: linear-gradient(145deg, #1e3a5f, #1a2d47);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid rgba(79, 195, 247, 0.2);
        }
        
        .kpi-card.warning {
            border-color: rgba(255, 152, 0, 0.4);
            background: linear-gradient(145deg, #3d2e1f, #2d2518);
        }
        
        .kpi-card.success {
            border-color: rgba(76, 175, 80, 0.4);
            background: linear-gradient(145deg, #1e3d2b, #1a2d22);
        }
        
        .kpi-card.danger {
            border-color: rgba(244, 67, 54, 0.4);
            background: linear-gradient(145deg, #3d1f1f, #2d1818);
        }
        
        .kpi-value {
            font-size: 2rem;
            font-weight: bold;
            color: #4fc3f7;
        }
        
        .kpi-card.warning .kpi-value { color: #ffb74d; }
        .kpi-card.success .kpi-value { color: #81c784; }
        .kpi-card.danger .kpi-value { color: #e57373; }
        
        .kpi-label {
            font-size: 0.85rem;
            color: #90a4ae;
            margin-top: 5px;
        }
        
        /* Chart Grid */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: linear-gradient(145deg, #1e3a5f, #1a2d47);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid rgba(79, 195, 247, 0.1);
        }
        
        .chart-container h3 {
            color: #4fc3f7;
            margin-bottom: 15px;
            font-size: 1rem;
            text-align: center;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        
        .chart-wrapper.tall {
            height: 400px;
        }
        
        /* Tables */
        .table-container {
            background: linear-gradient(145deg, #1e3a5f, #1a2d47);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid rgba(79, 195, 247, 0.1);
            margin-bottom: 25px;
            overflow-x: auto;
        }
        
        .table-container h3 {
            color: #4fc3f7;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(79, 195, 247, 0.1);
        }
        
        th {
            background: rgba(79, 195, 247, 0.1);
            color: #4fc3f7;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: rgba(79, 195, 247, 0.05);
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .badge-danger { background: rgba(244, 67, 54, 0.2); color: #e57373; }
        .badge-warning { background: rgba(255, 152, 0, 0.2); color: #ffb74d; }
        .badge-success { background: rgba(76, 175, 80, 0.2); color: #81c784; }
        
        /* Insights Section */
        .insights {
            background: linear-gradient(145deg, #1e3a5f, #1a2d47);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid rgba(79, 195, 247, 0.1);
        }
        
        .insights h3 {
            color: #4fc3f7;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        .insight-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        
        .insight-icon {
            font-size: 1.5rem;
            margin-right: 15px;
            min-width: 30px;
        }
        
        .insight-text h4 {
            color: #e4e4e4;
            font-size: 0.95rem;
            margin-bottom: 5px;
        }
        
        .insight-text p {
            color: #90a4ae;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        /* Tabs for tables */
        .tab-container {
            margin-bottom: 25px;
        }
        
        .tab-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: rgba(79, 195, 247, 0.1);
            border: 1px solid rgba(79, 195, 247, 0.2);
            color: #90a4ae;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }
        
        .tab-btn:hover {
            background: rgba(79, 195, 247, 0.2);
        }
        
        .tab-btn.active {
            background: rgba(79, 195, 247, 0.3);
            color: #4fc3f7;
            border-color: #4fc3f7;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            h1 { font-size: 1.5rem; }
            
            .kpi-value { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <h1>üìä CTL Warranty Analysis Dashboard</h1>
        <p class="subtitle">2026 Sell vs Repair Data Analysis</p>
        
        <!-- KPI Cards -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-value">425,216</div>
                <div class="kpi-label">Total Units Sold</div>
            </div>
            <div class="kpi-card warning">
                <div class="kpi-value">23,053</div>
                <div class="kpi-label">Total Repairs</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value">5.42%</div>
                <div class="kpi-label">Overall Repair Rate</div>
            </div>
            <div class="kpi-card danger">
                <div class="kpi-value">$1.48M</div>
                <div class="kpi-label">Total Repair Cost</div>
            </div>
            <div class="kpi-card warning">
                <div class="kpi-value">48.4%</div>
                <div class="kpi-label">Accidental Damage Rate</div>
            </div>
            <div class="kpi-card success">
                <div class="kpi-value">0.16%</div>
                <div class="kpi-label">Best Model Repair Rate</div>
            </div>
        </div>
        
        <!-- Charts Row 1 -->
        <div class="chart-grid">
            <div class="chart-container">
                <h3>üî¥ Top 10 Highest Repair Rates</h3>
                <div class="chart-wrapper tall">
                    <canvas id="repairRateChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <h3>üü¢ Top 10 Most Reliable Models</h3>
                <div class="chart-wrapper tall">
                    <canvas id="reliableChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Charts Row 2 -->
        <div class="chart-grid">
            <div class="chart-container">
                <h3>‚ö° Accidental vs Non-Accidental Repairs</h3>
                <div class="chart-wrapper">
                    <canvas id="repairTypeChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <h3>üí∞ Cost Distribution</h3>
                <div class="chart-wrapper">
                    <canvas id="costChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Charts Row 3 -->
        <div class="chart-grid">
            <div class="chart-container">
                <h3>üíµ Top 10 Models by Total Repair Cost</h3>
                <div class="chart-wrapper tall">
                    <canvas id="costByModelChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <h3>‚ö†Ô∏è Accidental Damage % by Model</h3>
                <div class="chart-wrapper tall">
                    <canvas id="accidentalChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Data Tables with Tabs -->
        <div class="table-container">
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="showTab('worst')">üî¥ Worst Reliability</button>
                    <button class="tab-btn" onclick="showTab('best')">üü¢ Best Reliability</button>
                    <button class="tab-btn" onclick="showTab('cost')">üíµ Highest Costs</button>
                    <button class="tab-btn" onclick="showTab('accidental')">‚ö†Ô∏è Accidental Damage</button>
                    <button class="tab-btn" onclick="showTab('all')">üìã All Models</button>
                </div>
                
                <div id="worst" class="tab-content active">
                    <table>
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Item #</th>
                                <th>Units Sold</th>
                                <th>Repairs</th>
                                <th>Repair Rate</th>
                                <th>Total Cost</th>
                            </tr>
                        </thead>
                        <tbody id="worstTable"></tbody>
                    </table>
                </div>
                
                <div id="best" class="tab-content">
                    <table>
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Item #</th>
                                <th>Units Sold</th>
                                <th>Repairs</th>
                                <th>Repair Rate</th>
                                <th>Total Cost</th>
                            </tr>
                        </thead>
                        <tbody id="bestTable"></tbody>
                    </table>
                </div>
                
                <div id="cost" class="tab-content">
                    <table>
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Units Sold</th>
                                <th>Repairs</th>
                                <th>Repair Rate</th>
                                <th>Total Cost</th>
                            </tr>
                        </thead>
                        <tbody id="costTable"></tbody>
                    </table>
                </div>
                
                <div id="accidental" class="tab-content">
                    <table>
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Accidental Claims</th>
                                <th>Total Repairs</th>
                                <th>Accidental %</th>
                            </tr>
                        </thead>
                        <tbody id="accidentalTable"></tbody>
                    </table>
                </div>
                
                <div id="all" class="tab-content">
                    <table>
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Item #</th>
                                <th>Sold</th>
                                <th>Major</th>
                                <th>Minor</th>
                                <th>NPU</th>
                                <th>Accidental</th>
                                <th>Total Repairs</th>
                                <th>Rate %</th>
                                <th>Cost</th>
                            </tr>
                        </thead>
                        <tbody id="allTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Key Insights -->
        <div class="insights">
            <h3>üìà Key Insights & Recommendations</h3>
            
            <div class="insight-item">
                <div class="insight-icon">üö®</div>
                <div class="insight-text">
                    <h4>Reliability Concern: NL72-L 4/64 LTE (CBUS1100013)</h4>
                    <p>Highest repair rate at 20.9% ‚Äî nearly 1 in 5 units require repair. Investigate root cause for this specific SKU vs the other NL72-L variant.</p>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon">‚≠ê</div>
                <div class="insight-text">
                    <h4>Best Performer: Chromebox CBx2 4/64 5205U</h4>
                    <p>Only 0.16% repair rate with 15,709 units sold. Chromebox products consistently outperform Chromebooks in reliability.</p>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon">üí•</div>
                <div class="insight-text">
                    <h4>Accidental Damage is Half of All Repairs (48.4%)</h4>
                    <p>11,149 accidental damage claims. Consider bundling protective cases or implementing handling training programs for high-damage models.</p>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon">üí∞</div>
                <div class="insight-text">
                    <h4>Major Repairs Drive 54% of Costs</h4>
                    <p>At $100 each, major repairs total $796,800. Focus engineering efforts on preventing major failure modes to reduce costs significantly.</p>
                </div>
            </div>
            
            <div class="insight-item">
                <div class="insight-icon">üéØ</div>
                <div class="insight-text">
                    <h4>Priority Models for Quality Improvement</h4>
                    <p>NL72TW/8/64 ($256K), NL72T N4500 ($248K), and NL72CT-L ($242K) account for over 50% of total repair costs due to high volume + high rates.</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Data
        const warrantyData = [
            {model: "CTL Chromebook NL72TW/8/64 CBU", item: "CBUS1100011", sold: 35388, major: 1182, minor: 2475, npu: 681, accidental: 1797, total: 4338},
            {model: "CTL Chromebook NL72T N4500 4/6", item: "CBUS1100017", sold: 37181, major: 1185, minor: 2404, npu: 471, accidental: 2086, total: 4060},
            {model: "CTL Chromebook NL72CT-L 4/64 L", item: "CBUS1100020", sold: 56259, major: 1605, minor: 1552, npu: 196, accidental: 1789, total: 3353},
            {model: "CTL Chromebook NL72 N5100 8/64", item: "CBUS1100015", sold: 23614, major: 499, minor: 1677, npu: 175, accidental: 929, total: 2351},
            {model: "CTL Chromebook PX14E 14\" HD", item: "CBUS1400003", sold: 6573, major: 650, minor: 438, npu: 74, accidental: 697, total: 1162},
            {model: "CTL Chromebook PX11E 4/32", item: "CBUS1100014", sold: 13940, major: 215, minor: 783, npu: 73, accidental: 681, total: 1071},
            {model: "CTL Chromebook PX11E 4/64", item: "CBUS1100022", sold: 20981, major: 446, minor: 406, npu: 123, accidental: 455, total: 975},
            {model: "CTL Chromebook NL73TW N100 360", item: "CBUS1100025", sold: 35933, major: 271, minor: 537, npu: 143, accidental: 484, total: 951},
            {model: "CTL Chromebook NL72 4/64", item: "CBUS1100016", sold: 22714, major: 221, minor: 495, npu: 107, accidental: 380, total: 823},
            {model: "CTL Chromebook NL73/8 N100 8/6", item: "CBUS1100024", sold: 24195, major: 231, minor: 254, npu: 52, accidental: 284, total: 537},
            {model: "CTL Chromebook NL72CT", item: "CBUS1100021", sold: 2994, major: 185, minor: 159, npu: 45, accidental: 248, total: 389},
            {model: "CTL Chromebook PX11E 4/32-180", item: "CBUS1100014A", sold: 1983, major: 154, minor: 195, npu: 21, accidental: 227, total: 370},
            {model: "CTL Chromebook NL72-L 4/64 LTE", item: "CBUS1100013", sold: 1679, major: 83, minor: 235, npu: 33, accidental: 194, total: 351},
            {model: "CTL Chromebook NL72-L 4/64 LTE", item: "CBUS1100019", sold: 7883, major: 1, minor: 16, npu: 0, accidental: 0, total: 17},
            {model: "CTL Chromebook NL73CT N100 8/6", item: "CBUS1100026", sold: 13093, major: 133, minor: 178, npu: 22, accidental: 160, total: 333},
            {model: "CTL Chromebook PX14EXT 14\" Tou", item: "CBUS1400005", sold: 2475, major: 150, minor: 102, npu: 42, accidental: 164, total: 294},
            {model: "CTL Chromebook PX111E 4/64", item: "CBUS1100033", sold: 12330, major: 129, minor: 47, npu: 16, accidental: 73, total: 192},
            {model: "CTL Chromebook PX111E 8/64", item: "CBUS1100034", sold: 5509, major: 95, minor: 60, npu: 24, accidental: 84, total: 179},
            {model: "CTL Chromebook PX14EX 14\" FHD", item: "CBUS1400004", sold: 3511, major: 70, minor: 68, npu: 34, accidental: 65, total: 172},
            {model: "CTL Chromebook PX141E N100 8/6", item: "CBUS1400011", sold: 10859, major: 101, minor: 33, npu: 13, accidental: 73, total: 147},
            {model: "CTL GOOGLE MEET GQE15C SYSTEM", item: "CBXUS190005", sold: 13042, major: 51, minor: 88, npu: 6, accidental: 0, total: 145},
            {model: "CTL Chromebook NL73TWB N200 8/", item: "CBUS1100030", sold: 649, major: 44, minor: 59, npu: 20, accidental: 68, total: 123},
            {model: "CTL Chromebook NL73 N100 4/64", item: "CBUS1100028", sold: 11992, major: 51, minor: 65, npu: 6, accidental: 41, total: 122},
            {model: "CTL Chromebook NL73T N100 360", item: "CBUS1100027", sold: 3481, major: 28, minor: 59, npu: 17, accidental: 39, total: 104},
            {model: "CTL Meet Compute System (GQE20C)", item: "CBXUS190020", sold: 6152, major: 33, minor: 33, npu: 6, accidental: 0, total: 72},
            {model: "CTL PX14EXT 14\" TS 8/128-N6000", item: "CBUS1400009", sold: 1055, major: 20, minor: 13, npu: 14, accidental: 22, total: 47},
            {model: "CTL Chromebox CBx3 Cel 7305", item: "CBXUS190010", sold: 7369, major: 10, minor: 21, npu: 2, accidental: 0, total: 33},
            {model: "CTL PX14EXT 14\" TS 8/64-N6000", item: "CBUS1400007", sold: 1495, major: 14, minor: 9, npu: 8, accidental: 10, total: 31},
            {model: "CTL Chromebook PX141EXT", item: "CBUS1400012", sold: 5009, major: 16, minor: 11, npu: 2, accidental: 8, total: 29},
            {model: "CTL Chromebook PX141GXT", item: "CBUS1400015", sold: 3062, major: 14, minor: 5, npu: 7, accidental: 7, total: 26},
            {model: "CTL Chromebox CBx2 4/64 5205U", item: "CBXUS190003", sold: 15709, major: 13, minor: 10, npu: 2, accidental: 0, total: 25},
            {model: "CTL Chrome Tablet Tx1 4GB/32", item: "NBCTX1", sold: 4257, major: 11, minor: 2, npu: 6, accidental: 8, total: 19},
            {model: "CTL NL73TW CHROMEBOOK GEN2", item: "CBUS1100035", sold: 3346, major: 2, minor: 9, npu: 3, accidental: 6, total: 14},
            {model: "CTL NL73 CHROMEBOOK GEN2", item: "CBUS1100037", sold: 3632, major: 8, minor: 2, npu: 1, accidental: 8, total: 11},
            {model: "CTL Chromebox CBx3-7 i7-1355U", item: "CBXUS190011", sold: 1016, major: 4, minor: 5, npu: 2, accidental: 0, total: 11},
            {model: "CTL Chromebook PX141GX", item: "CBUS1400013", sold: 1530, major: 6, minor: 2, npu: 1, accidental: 5, total: 9},
            {model: "CTL Chromebox CBx2-7 8/128", item: "CBXUS190004", sold: 1420, major: 4, minor: 2, npu: 1, accidental: 0, total: 7},
            {model: "CTL Chromebook NL72T N5100 4/6", item: "CBUS1100023", sold: 873, major: 1, minor: 3, npu: 1, accidental: 1, total: 5}
        ];
        
        // Calculate derived fields
        warrantyData.forEach(d => {
            d.repairRate = d.sold > 0 ? ((d.total / d.sold) * 100).toFixed(2) : 0;
            d.accidentalPct = d.total > 0 ? ((d.accidental / d.total) * 100).toFixed(1) : 0;
            d.totalCost = (d.major * 100) + (d.minor * 50) + (d.npu * 20);
            d.shortName = d.model.replace('CTL Chromebook ', '').replace('CTL ', '').substring(0, 22);
        });
        
        // Filter significant models (500+ units)
        const significantData = warrantyData.filter(d => d.sold >= 500);
        
        // Sort for different views
        const byRepairRate = [...significantData].sort((a, b) => b.repairRate - a.repairRate);
        const byReliable = [...significantData].sort((a, b) => a.repairRate - b.repairRate);
        const byCost = [...warrantyData].sort((a, b) => b.totalCost - a.totalCost);
        const byAccidental = [...significantData].filter(d => d.total > 0).sort((a, b) => b.accidentalPct - a.accidentalPct);
        
        // Chart colors
        const redGradient = ['#ef5350', '#e53935', '#d32f2f', '#c62828', '#b71c1c', '#a31515', '#8e0000', '#7a0000', '#660000', '#520000'];
        const greenGradient = ['#66bb6a', '#4caf50', '#43a047', '#388e3c', '#2e7d32', '#27692a', '#1b5e20', '#145218', '#0d4610', '#063a08'];
        const purpleGradient = ['#ab47bc', '#9c27b0', '#8e24aa', '#7b1fa2', '#6a1b9a', '#5c1690', '#4a148c', '#3d1177', '#300d62', '#23094d'];
        
        // Repair Rate Chart (Top 10 Worst)
        new Chart(document.getElementById('repairRateChart'), {
            type: 'bar',
            data: {
                labels: byRepairRate.slice(0, 10).map(d => d.shortName),
                datasets: [{
                    label: 'Repair Rate %',
                    data: byRepairRate.slice(0, 10).map(d => d.repairRate),
                    backgroundColor: redGradient,
                    borderColor: redGradient,
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Repair Rate (%)', color: '#90a4ae' },
                        ticks: { color: '#90a4ae' },
                        grid: { color: 'rgba(79, 195, 247, 0.1)' }
                    },
                    y: {
                        ticks: { color: '#e4e4e4', font: { size: 11 } },
                        grid: { display: false }
                    }
                }
            }
        });
        
        // Reliable Chart (Top 10 Best)
        new Chart(document.getElementById('reliableChart'), {
            type: 'bar',
            data: {
                labels: byReliable.slice(0, 10).map(d => d.shortName),
                datasets: [{
                    label: 'Repair Rate %',
                    data: byReliable.slice(0, 10).map(d => d.repairRate),
                    backgroundColor: greenGradient,
                    borderColor: greenGradient,
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Repair Rate (%)', color: '#90a4ae' },
                        ticks: { color: '#90a4ae' },
                        grid: { color: 'rgba(79, 195, 247, 0.1)' }
                    },
                    y: {
                        ticks: { color: '#e4e4e4', font: { size: 11 } },
                        grid: { display: false }
                    }
                }
            }
        });
        
        // Repair Type Distribution - Accidental vs Non-Accidental
        const totalRepairs = warrantyData.reduce((sum, d) => sum + d.total, 0);
        const totalAccidental = warrantyData.reduce((sum, d) => sum + d.accidental, 0);
        const totalNonAccidental = totalRepairs - totalAccidental;
        
        // For cost calculation
        const totalMajor = warrantyData.reduce((sum, d) => sum + d.major, 0);
        const totalMinor = warrantyData.reduce((sum, d) => sum + d.minor, 0);
        const totalNPU = warrantyData.reduce((sum, d) => sum + d.npu, 0);
        
        new Chart(document.getElementById('repairTypeChart'), {
            type: 'doughnut',
            data: {
                labels: ['Accidental Damage', 'Non-Accidental'],
                datasets: [{
                    data: [totalAccidental, totalNonAccidental],
                    backgroundColor: ['#ba68c8', '#4fc3f7'],
                    borderColor: '#1a2d47',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: { color: '#e4e4e4', padding: 15 }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const value = context.raw;
                                const percentage = ((value / totalRepairs) * 100).toFixed(1);
                                return `${context.label}: ${value.toLocaleString()} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });
        
        // Cost Distribution
        const majorCost = totalMajor * 100;
        const minorCost = totalMinor * 50;
        const npuCost = totalNPU * 20;
        
        new Chart(document.getElementById('costChart'), {
            type: 'doughnut',
            data: {
                labels: ['Major ($100)', 'Minor ($50)', 'NPU/NPF ($20)'],
                datasets: [{
                    data: [majorCost, minorCost, npuCost],
                    backgroundColor: ['#e57373', '#ffb74d', '#4fc3f7'],
                    borderColor: '#1a2d47',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: { color: '#e4e4e4', padding: 15 }
                    }
                }
            }
        });
        
        // Cost by Model Chart
        new Chart(document.getElementById('costByModelChart'), {
            type: 'bar',
            data: {
                labels: byCost.slice(0, 10).map(d => d.shortName),
                datasets: [{
                    label: 'Total Cost ($)',
                    data: byCost.slice(0, 10).map(d => d.totalCost),
                    backgroundColor: '#ffb74d',
                    borderColor: '#ff9800',
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Total Repair Cost ($)', color: '#90a4ae' },
                        ticks: { 
                            color: '#90a4ae',
                            callback: value => '$' + (value/1000).toFixed(0) + 'K'
                        },
                        grid: { color: 'rgba(79, 195, 247, 0.1)' }
                    },
                    y: {
                        ticks: { color: '#e4e4e4', font: { size: 11 } },
                        grid: { display: false }
                    }
                }
            }
        });
        
        // Accidental Damage Chart
        new Chart(document.getElementById('accidentalChart'), {
            type: 'bar',
            data: {
                labels: byAccidental.slice(0, 10).map(d => d.shortName),
                datasets: [{
                    label: 'Accidental %',
                    data: byAccidental.slice(0, 10).map(d => d.accidentalPct),
                    backgroundColor: purpleGradient,
                    borderColor: purpleGradient,
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Accidental Damage % of Repairs', color: '#90a4ae' },
                        ticks: { color: '#90a4ae' },
                        grid: { color: 'rgba(79, 195, 247, 0.1)' }
                    },
                    y: {
                        ticks: { color: '#e4e4e4', font: { size: 11 } },
                        grid: { display: false }
                    }
                }
            }
        });
        
        // Populate Tables
        function getRateBadge(rate) {
            rate = parseFloat(rate);
            if (rate > 10) return `<span class="badge badge-danger">${rate}%</span>`;
            if (rate > 5) return `<span class="badge badge-warning">${rate}%</span>`;
            return `<span class="badge badge-success">${rate}%</span>`;
        }
        
        function formatCurrency(val) {
            return '$' + val.toLocaleString();
        }
        
        // Worst table
        document.getElementById('worstTable').innerHTML = byRepairRate.slice(0, 15).map(d => `
            <tr>
                <td>${d.model}</td>
                <td>${d.item}</td>
                <td>${d.sold.toLocaleString()}</td>
                <td>${d.total.toLocaleString()}</td>
                <td>${getRateBadge(d.repairRate)}</td>
                <td>${formatCurrency(d.totalCost)}</td>
            </tr>
        `).join('');
        
        // Best table
        document.getElementById('bestTable').innerHTML = byReliable.slice(0, 15).map(d => `
            <tr>
                <td>${d.model}</td>
                <td>${d.item}</td>
                <td>${d.sold.toLocaleString()}</td>
                <td>${d.total.toLocaleString()}</td>
                <td>${getRateBadge(d.repairRate)}</td>
                <td>${formatCurrency(d.totalCost)}</td>
            </tr>
        `).join('');
        
        // Cost table
        document.getElementById('costTable').innerHTML = byCost.slice(0, 15).map(d => `
            <tr>
                <td>${d.model}</td>
                <td>${d.sold.toLocaleString()}</td>
                <td>${d.total.toLocaleString()}</td>
                <td>${getRateBadge(d.repairRate)}</td>
                <td>${formatCurrency(d.totalCost)}</td>
            </tr>
        `).join('');
        
        // Accidental table
        document.getElementById('accidentalTable').innerHTML = byAccidental.slice(0, 15).map(d => `
            <tr>
                <td>${d.model}</td>
                <td>${d.accidental.toLocaleString()}</td>
                <td>${d.total.toLocaleString()}</td>
                <td>${d.accidentalPct}%</td>
            </tr>
        `).join('');
        
        // All models table
        document.getElementById('allTable').innerHTML = warrantyData.sort((a,b) => b.totalCost - a.totalCost).map(d => `
            <tr>
                <td>${d.model}</td>
                <td>${d.item}</td>
                <td>${d.sold.toLocaleString()}</td>
                <td>${d.major}</td>
                <td>${d.minor}</td>
                <td>${d.npu}</td>
                <td>${d.accidental}</td>
                <td>${d.total}</td>
                <td>${getRateBadge(d.repairRate)}</td>
                <td>${formatCurrency(d.totalCost)}</td>
            </tr>
        `).join('');
        
        // Tab functionality
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
