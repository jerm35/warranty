<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CTL Warranty Analysis Dashboard - All Models</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e4e4e4;
            min-height: 100vh;
            padding: 20px;
        }
        
        /* Password Overlay */
        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .password-box {
            background: linear-gradient(145deg, #1e3a5f, #1a2d47);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            border: 1px solid rgba(79, 195, 247, 0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .password-box h2 {
            color: #4fc3f7;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }
        
        .password-box p {
            color: #90a4ae;
            margin-bottom: 25px;
            font-size: 0.9rem;
        }
        
        .password-box input {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid rgba(79, 195, 247, 0.3);
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            color: #e4e4e4;
            font-size: 1rem;
            margin-bottom: 20px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .password-box input:focus {
            border-color: #4fc3f7;
        }
        
        .password-box button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(145deg, #4fc3f7, #29b6f6);
            border: none;
            border-radius: 8px;
            color: #1a1a2e;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .password-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 195, 247, 0.4);
        }
        
        .password-error {
            color: #e57373;
            font-size: 0.85rem;
            margin-top: 15px;
            display: none;
        }
        
        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(145deg, #4fc3f7, #29b6f6);
            border: none;
            border-radius: 8px;
            color: #1a1a2e;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-left: 20px;
        }
        
        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 195, 247, 0.4);
        }
        
        .nav-button.all-models {
            background: linear-gradient(145deg, #ba68c8, #9c27b0);
        }
        
        .header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .header-row h1 {
            margin-bottom: 0;
        }
        
        .data-note {
            color: #90a4ae;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: linear-gradient(145deg, #ff9800, #f57c00);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-left: 15px;
        }
        
        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
        }
        
        .nav-button.secondary {
            background: linear-gradient(145deg, #4fc3f7, #29b6f6);
        }
        
        .nav-button.secondary:hover {
            box-shadow: 0 4px 15px rgba(79, 195, 247, 0.4);
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Model Detail Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: linear-gradient(145deg, #1e3a5f, #1a2d47);
            border-radius: 16px;
            padding: 30px;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            border: 1px solid rgba(79, 195, 247, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(79, 195, 247, 0.2);
        }
        
        .modal-header h2 {
            color: #4fc3f7;
            font-size: 1.3rem;
            flex: 1;
        }
        
        .modal-header .item-number {
            color: #90a4ae;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #90a4ae;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
            transition: color 0.2s;
        }
        
        .modal-close:hover {
            color: #e57373;
        }
        
        .modal-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .modal-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .modal-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4fc3f7;
        }
        
        .modal-stat-value.warning { color: #ffb74d; }
        .modal-stat-value.danger { color: #e57373; }
        .modal-stat-value.success { color: #81c784; }
        .modal-stat-value.purple { color: #ba68c8; }
        
        .modal-stat-label {
            font-size: 0.8rem;
            color: #90a4ae;
            margin-top: 5px;
        }
        
        .modal-section {
            margin-bottom: 20px;
        }
        
        .modal-section h4 {
            color: #4fc3f7;
            font-size: 0.95rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .breakdown-item {
            background: rgba(0,0,0,0.15);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        
        .breakdown-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #e4e4e4;
        }
        
        .breakdown-label {
            font-size: 0.75rem;
            color: #90a4ae;
            margin-top: 3px;
        }
        
        .breakdown-cost {
            font-size: 0.8rem;
            color: #ffb74d;
            margin-top: 5px;
        }
        
        .modal-bar {
            height: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .modal-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .modal-bar-fill.accidental { background: linear-gradient(90deg, #ba68c8, #9c27b0); }
        .modal-bar-fill.warranty { background: linear-gradient(90deg, #81c784, #4caf50); }
        .modal-bar-fill.repair-rate { background: linear-gradient(90deg, #e57373, #f44336); }
        
        .modal-comparison {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.8rem;
        }
        
        .modal-comparison span:first-child { color: #81c784; }
        .modal-comparison span:last-child { color: #e57373; }
        
        /* Pie Chart Detail Modal */
        .pie-modal-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.85rem;
        }
        
        .pie-modal-table th,
        .pie-modal-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(79, 195, 247, 0.1);
        }
        
        .pie-modal-table th {
            background: rgba(79, 195, 247, 0.1);
            color: #4fc3f7;
            font-weight: 600;
        }
        
        .pie-modal-table tr:hover {
            background: rgba(79, 195, 247, 0.05);
            cursor: pointer;
        }
        
        .pie-modal-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .pie-summary-stat {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .pie-summary-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4fc3f7;
        }
        
        .pie-summary-value.purple { color: #ba68c8; }
        .pie-summary-value.green { color: #81c784; }
        .pie-summary-value.red { color: #e57373; }
        .pie-summary-value.orange { color: #ffb74d; }
        
        .pie-summary-label {
            font-size: 0.8rem;
            color: #90a4ae;
            margin-top: 5px;
        }
        
        .click-hint {
            text-align: center;
            color: #546e7a;
            font-size: 0.75rem;
            margin-top: 10px;
            font-style: italic;
        }
        
        .chart-container canvas {
            cursor: pointer;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #4fc3f7;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .subtitle {
            text-align: center;
            color: #90a4ae;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }
        
        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: linear-gradient(145deg, #1e3a5f, #1a2d47);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid rgba(79, 195, 247, 0.2);
        }
        
        .kpi-card.warning {
            border-color: rgba(255, 152, 0, 0.4);
            background: linear-gradient(145deg, #3d2e1f, #2d2518);
        }
        
        .kpi-card.success {
            border-color: rgba(76, 175, 80, 0.4);
            background: linear-gradient(145deg, #1e3d2b, #1a2d22);
        }
        
        .kpi-card.danger {
            border-color: rgba(244, 67, 54, 0.4);
            background: linear-gradient(145deg, #3d1f1f, #2d1818);
        }
        
        .kpi-card.purple {
            border-color: rgba(186, 104, 200, 0.4);
            background: linear-gradient(145deg, #2d1f3d, #251833);
        }
        
        .kpi-value {
            font-size: 2rem;
            font-weight: bold;
            color: #4fc3f7;
        }
        
        .kpi-card.warning .kpi-value { color: #ffb74d; }
        .kpi-card.success .kpi-value { color: #81c784; }
        .kpi-card.danger .kpi-value { color: #e57373; }
        .kpi-card.purple .kpi-value { color: #ba68c8; }
        
        .kpi-label {
            font-size: 0.85rem;
            color: #90a4ae;
            margin-top: 5px;
        }
        
        /* Chart Grid */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: linear-gradient(145deg, #1e3a5f, #1a2d47);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid rgba(79, 195, 247, 0.1);
        }
        
        .chart-container h3 {
            color: #4fc3f7;
            margin-bottom: 15px;
            font-size: 1rem;
            text-align: center;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        
        .chart-wrapper.tall {
            height: 400px;
        }
        
        /* Tables */
        .table-container {
            background: linear-gradient(145deg, #1e3a5f, #1a2d47);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid rgba(79, 195, 247, 0.1);
            margin-bottom: 25px;
            overflow-x: auto;
        }
        
        .table-container h3 {
            color: #4fc3f7;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(79, 195, 247, 0.1);
        }
        
        th {
            background: rgba(79, 195, 247, 0.1);
            color: #4fc3f7;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        tr {
            cursor: pointer;
            transition: background 0.2s;
        }
        
        tr:hover {
            background: rgba(79, 195, 247, 0.1);
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .badge-danger { background: rgba(244, 67, 54, 0.2); color: #e57373; }
        .badge-warning { background: rgba(255, 152, 0, 0.2); color: #ffb74d; }
        .badge-success { background: rgba(76, 175, 80, 0.2); color: #81c784; }
        
        /* Insights Section */
        .insights {
            background: linear-gradient(145deg, #1e3a5f, #1a2d47);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid rgba(79, 195, 247, 0.1);
            margin-bottom: 25px;
        }
        
        .insights h3 {
            color: #4fc3f7;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        .insight-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        
        .insight-icon {
            font-size: 1.5rem;
            margin-right: 15px;
            min-width: 30px;
        }
        
        .insight-text h4 {
            color: #e4e4e4;
            font-size: 0.95rem;
            margin-bottom: 5px;
        }
        
        .insight-text p {
            color: #90a4ae;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        /* Tabs for tables */
        .tab-container {
            margin-bottom: 25px;
        }
        
        .tab-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: rgba(79, 195, 247, 0.1);
            border: 1px solid rgba(79, 195, 247, 0.2);
            color: #90a4ae;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }
        
        .tab-btn:hover {
            background: rgba(79, 195, 247, 0.2);
        }
        
        .tab-btn.active {
            background: rgba(79, 195, 247, 0.3);
            color: #4fc3f7;
            border-color: #4fc3f7;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            color: #546e7a;
            font-size: 0.8rem;
            margin-top: 30px;
            padding: 20px;
        }
        
        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .kpi-value {
                font-size: 1.5rem;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .modal-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-breakdown {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Password Overlay -->
    <div class="password-overlay" id="passwordOverlay">
        <div class="password-box">
            <h2>üîê CTL Warranty Dashboard</h2>
            <p>Enter the password to access the warranty analysis data</p>
            <input type="password" id="passwordInput" placeholder="Enter password..." onkeypress="if(event.key==='Enter')checkPassword()">
            <button onclick="checkPassword()">Access Dashboard</button>
            <p class="password-error" id="passwordError">Incorrect password. Please try again.</p>
        </div>
    </div>

    <!-- Model Detail Modal -->
    <div class="modal-overlay" id="modelModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h2 id="modalTitle">Model Name</h2>
                    <div class="item-number" id="modalItemNumber">Item #</div>
                </div>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            
            <div class="modal-stats-grid" id="modalStatsGrid">
                <!-- Stats populated by JS -->
            </div>
            
            <div class="modal-section">
                <h4>üîß Repair Breakdown</h4>
                <div class="modal-breakdown" id="modalRepairBreakdown">
                    <!-- Populated by JS -->
                </div>
            </div>
            
            <div class="modal-section">
                <h4>üí• Accidental Damage Rate</h4>
                <div class="modal-bar">
                    <div class="modal-bar-fill accidental" id="modalAccidentalBar"></div>
                </div>
                <div class="modal-comparison">
                    <span>Non-Accidental</span>
                    <span id="modalAccidentalPct">0%</span>
                </div>
            </div>
            
            <div class="modal-section">
                <h4>üìã Warranty Status</h4>
                <div class="modal-bar">
                    <div class="modal-bar-fill warranty" id="modalWarrantyBar"></div>
                </div>
                <div class="modal-comparison">
                    <span id="modalInWarrantyPct">In Warranty: 0%</span>
                    <span id="modalOutWarrantyPct">Out: 0%</span>
                </div>
            </div>
            
            <div class="modal-section">
                <h4>üìà Repair Rate vs Fleet Average</h4>
                <div class="modal-bar">
                    <div class="modal-bar-fill repair-rate" id="modalRepairRateBar"></div>
                </div>
                <div class="modal-comparison">
                    <span>Fleet Avg: 5.27%</span>
                    <span id="modalRepairRatePct">This Model: 0%</span>
                </div>
            </div>
            
            <div class="modal-section">
                <h4>üî© Top 10 Repair Categories</h4>
                <table class="pie-modal-table">
                    <thead>
                        <tr><th>Repair Type</th><th>Count</th><th>% of Model</th></tr>
                    </thead>
                    <tbody id="modalRepairCategoriesTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Pie Chart Detail Modal -->
    <div class="modal-overlay" id="pieModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h2 id="pieModalTitle">Category Breakdown</h2>
                    <div class="item-number" id="pieModalSubtitle">Details</div>
                </div>
                <button class="modal-close" onclick="closePieModal()">&times;</button>
            </div>
            
            <div class="pie-modal-summary" id="pieModalSummary">
                <!-- Summary stats populated by JS -->
            </div>
            
            <div class="modal-section">
                <h4 id="pieModalTableTitle">üìä Model Breakdown</h4>
                <table class="pie-modal-table">
                    <thead id="pieModalTableHead">
                        <!-- Headers populated by JS -->
                    </thead>
                    <tbody id="pieModalTableBody">
                        <!-- Data populated by JS -->
                    </tbody>
                </table>
            </div>
            
            <div class="modal-section">
                <h4>üî© Top 10 Repair Categories</h4>
                <table class="pie-modal-table">
                    <thead>
                        <tr><th>Repair Type</th><th>Count</th><th>% of Category</th></tr>
                    </thead>
                    <tbody id="pieModalRepairCategories"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard hidden" id="dashboard">
        <div style="text-align: right; margin-bottom: 10px;">
            <a href="index.html" class="nav-button">
                üìã View Excluding NL71/NL81
            </a>
        </div>
        <h1>üìä CTL Warranty Analysis Dashboard - All Models</h1>
        <p class="subtitle">Repair Data 2023-2025 | All Models with >1,000 units sold | Including NL71/NL81</p>
        <div class="header-actions">
            <span style="color: #ffb74d; font-size: 0.9rem;">‚ö† Includes NL71/NL81 legacy models ‚Ä¢ Only completed repairs (Order Received Date required)</span>
        </div>
        
        <!-- KPI Cards -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-value" id="kpiUnitsSold">-</div>
                <div class="kpi-label">Total Units Sold</div>
            </div>
            <div class="kpi-card warning">
                <div class="kpi-value" id="kpiTotalRepairs">-</div>
                <div class="kpi-label">Total Repairs</div>
            </div>
            <div class="kpi-card danger">
                <div class="kpi-value" id="kpiRepairRate">-</div>
                <div class="kpi-label">Overall Repair Rate</div>
            </div>
            <div class="kpi-card warning">
                <div class="kpi-value" id="kpiTotalCost">-</div>
                <div class="kpi-label">Est. Total Repair Cost</div>
            </div>
            <div class="kpi-card purple">
                <div class="kpi-value" id="kpiAccidental">-</div>
                <div class="kpi-label">Accidental Damage %</div>
            </div>
            <div class="kpi-card success">
                <div class="kpi-value" id="kpiInWarranty">-</div>
                <div class="kpi-label">In Warranty %</div>
            </div>
        </div>
        
        <!-- Charts Row 1 -->
        <div class="chart-grid">
            <div class="chart-container">
                <h3>üìà Repair Rate by Model (Highest to Lowest)</h3>
                <div class="chart-wrapper tall">
                    <canvas id="repairRateChart"></canvas>
                </div>
                <p class="click-hint">üí° Click on any bar to view detailed model information</p>
            </div>
            <div class="chart-container">
                <h3>üí∞ Estimated Repair Cost by Model (Top 15)</h3>
                <div class="chart-wrapper tall">
                    <canvas id="costByModelChart"></canvas>
                </div>
                <p class="click-hint">üí° Click on any bar to view detailed model information</p>
            </div>
        </div>
        
        <!-- Charts Row 2 -->
        <div class="chart-grid">
            <div class="chart-container">
                <h3>üîß Repair Type Distribution</h3>
                <div class="chart-wrapper">
                    <canvas id="repairTypeChart"></canvas>
                </div>
                <p class="click-hint">üí° Click on any segment to view model breakdown</p>
            </div>
            <div class="chart-container">
                <h3>üíµ Cost Breakdown by Repair Type</h3>
                <div class="chart-wrapper">
                    <canvas id="costChart"></canvas>
                </div>
                <p class="click-hint">üí° Click on any segment to view model breakdown</p>
            </div>
        </div>
        
        <!-- Charts Row 3 -->
        <div class="chart-grid">
            <div class="chart-container">
                <h3>‚ö†Ô∏è Accidental Damage Rate by Model <span style="font-size: 0.7rem; color: #90a4ae; font-weight: normal;">(100+ repairs only)</span></h3>
                <div class="chart-wrapper tall">
                    <canvas id="accidentalChart"></canvas>
                </div>
                <p class="click-hint">üí° Click on any bar to view detailed model information</p>
            </div>
            <div class="chart-container">
                <h3>üìã Warranty Status Distribution</h3>
                <div class="chart-wrapper">
                    <canvas id="warrantyChart"></canvas>
                </div>
                <p class="click-hint">üí° Click on any segment to view model breakdown</p>
            </div>
        </div>
        
        <!-- Cost Analysis Charts -->
        <div class="chart-grid">
            <div class="chart-container">
                <h3>üí• Accidental Damage Cost by Model <span style="font-size: 0.7rem; color: #90a4ae; font-weight: normal;">(100+ repairs only)</span></h3>
                <div class="chart-wrapper">
                    <canvas id="accidentalCostChart"></canvas>
                </div>
                <p class="click-hint">üí° Click on any bar to view detailed model information</p>
            </div>
            <div class="chart-container">
                <h3>üìã Total Cost: In Warranty vs Out of Warranty</h3>
                <div class="chart-wrapper">
                    <canvas id="warrantyCostChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Insights Section -->
        <div class="insights">
            <h3>üîç Key Insights & Analysis</h3>
            <div id="insightsList"></div>
        </div>
        
        <!-- Data Tables -->
        <div class="table-container">
            <h3>üìä Model Analysis Tables <span style="font-size: 0.8rem; color: #90a4ae; font-weight: normal;">(click any row for details)</span></h3>
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="showTab('worstTab')">‚ö†Ô∏è Highest Repair Rate</button>
                <button class="tab-btn" onclick="showTab('bestTab')">‚úÖ Most Reliable</button>
                <button class="tab-btn" onclick="showTab('costTab')">üí∞ Highest Cost</button>
                <button class="tab-btn" onclick="showTab('accidentalTab')">üí• Accidental Damage</button>
                <button class="tab-btn" onclick="showTab('warrantyTab')">üìã Warranty Status</button>
                <button class="tab-btn" onclick="showTab('allTab')">üìÑ All Models</button>
            </div>
            
            <div id="worstTab" class="tab-content active">
                <table>
                    <thead>
                        <tr>
                            <th>Model</th>
                            <th>Item #</th>
                            <th>Units Sold</th>
                            <th>Total Repairs</th>
                            <th>Repair Rate</th>
                            <th>Est. Cost</th>
                        </tr>
                    </thead>
                    <tbody id="worstTable"></tbody>
                </table>
            </div>
            
            <div id="bestTab" class="tab-content">
                <table>
                    <thead>
                        <tr>
                            <th>Model</th>
                            <th>Item #</th>
                            <th>Units Sold</th>
                            <th>Total Repairs</th>
                            <th>Repair Rate</th>
                            <th>Est. Cost</th>
                        </tr>
                    </thead>
                    <tbody id="bestTable"></tbody>
                </table>
            </div>
            
            <div id="costTab" class="tab-content">
                <table>
                    <thead>
                        <tr>
                            <th>Model</th>
                            <th>Units Sold</th>
                            <th>Total Repairs</th>
                            <th>Repair Rate</th>
                            <th>Est. Total Cost</th>
                        </tr>
                    </thead>
                    <tbody id="costTable"></tbody>
                </table>
            </div>
            
            <div id="accidentalTab" class="tab-content">
                <table>
                    <thead>
                        <tr>
                            <th>Model</th>
                            <th>Accidental Repairs</th>
                            <th>Total Repairs</th>
                            <th>Accidental %</th>
                        </tr>
                    </thead>
                    <tbody id="accidentalTable"></tbody>
                </table>
            </div>
            
            <div id="warrantyTab" class="tab-content">
                <table>
                    <thead>
                        <tr>
                            <th>Model</th>
                            <th>In Warranty</th>
                            <th>Out of Warranty</th>
                            <th>In Warranty %</th>
                            <th>Out of Warranty %</th>
                        </tr>
                    </thead>
                    <tbody id="warrantyTable"></tbody>
                </table>
            </div>
            
            <div id="allTab" class="tab-content">
                <table>
                    <thead>
                        <tr>
                            <th>Model</th>
                            <th>Item #</th>
                            <th>Units Sold</th>
                            <th>Major</th>
                            <th>Minor</th>
                            <th>NPU/NPF</th>
                            <th>Accidental</th>
                            <th>Total</th>
                            <th>Repair Rate</th>
                            <th>Est. Cost</th>
                        </tr>
                    </thead>
                    <tbody id="allTable"></tbody>
                </table>
            </div>
        </div>
        
        <div class="footer">
            CTL Warranty Analysis Dashboard | Data: 2023-2025 | Generated February 2026<br>
            Filtered: Models with >1000 units sold | Excluded: NL71 and NL81 models
        </div>
    </div>

    <script>
        // Global data store
        let warrantyData = [];
        let dataByItem = {};
        
        // Repair categories by model and category (with Order Received Date filter applied) - ALL MODELS INCLUDING NL71/NL81
        const repairCategories = {
            modelRepairs: {"CBUS1100001": [["Battery", 407], ["Keyboard", 302], ["NPU", 264], ["Mainboard", 181], ["Panel", 99], ["Keyboard Keys", 91], ["Declined", 87], ["NPF", 73], ["Camera", 28], ["Other", 26]], "CBUS1100002": [["Mainboard", 177], ["NPU", 100], ["Battery", 92], ["Keyboard", 88], ["OS Issue", 71], ["Declined", 51], ["NPF", 41], ["Keyboard Keys", 37], ["Wifi Module", 36], ["Other", 25]], "CBUS1100003": [["Keyboard", 1106], ["Mainboard", 850], ["Panel", 639], ["Keyboard Keys", 631], ["NPU", 616], ["Battery", 458], ["NPF", 163], ["Hinge", 154], ["Other", 128], ["Hinge Cover", 92]], "CBUS1100004": [["Keyboard", 161], ["Keyboard Keys", 62], ["Panel", 42], ["Declined", 12], ["NPU", 11], ["Tear Down", 10], ["NPF", 9], ["Mainboard", 4], ["Daughterboard", 3], ["Battery", 2]], "CBUS1100005": [["Keyboard", 194], ["NPU", 149], ["Panel", 79], ["NPF", 54], ["Keyboard Keys", 50], ["Battery", 42], ["Mainboard", 41], ["Wifi Module", 13], ["Touchpad", 12], ["Camera", 10]], "CBUS1100006": [["Mainboard", 154], ["Panel", 141], ["Keyboard", 116], ["Battery", 76], ["NPF", 65], ["Other", 57], ["NPU", 25], ["Keyboard Keys", 24], ["Plastics", 23], ["Wifi Module", 20]], "CBUS1100007": [["NPU", 5658], ["Mainboard", 5138], ["Keyboard", 3562], ["Battery", 2626], ["Keyboard Keys", 2145], ["Panel", 1535], ["NPF", 926], ["Hinge", 580], ["Wifi Module", 571], ["Other", 491]], "CBUS1100008": [["Panel", 213], ["Battery", 124], ["Keyboard", 111], ["Mainboard", 38], ["Declined", 19], ["Keyboard Keys", 13], ["Other", 8], ["Daughterboard", 6], ["NPF", 6], ["NPU", 4]], "CBUS1100011": [["Keyboard", 998], ["Panel", 628], ["NPU", 479], ["Keyboard Keys", 399], ["Mainboard", 380], ["Daughterboard", 277], ["NPF", 201], ["Plastics", 193], ["Hinge", 139], ["Battery", 135]], "CBUS1100013": [["Keyboard", 76], ["Panel", 68], ["Keyboard Keys", 67], ["Camera", 41], ["NPU", 20], ["NPF", 13], ["Mainboard", 11], ["Other", 11], ["LVDS", 9], ["LTE Module", 6]], "CBUS1100014": [["Hinge", 535], ["Panel", 152], ["Keyboard", 135], ["Keyboard Keys", 67], ["Mainboard", 48], ["NPU", 42], ["NPF", 31], ["Other", 17], ["Replacement", 9], ["Declined", 7]], "CBUS1100014A": [["Panel", 123], ["Keyboard", 92], ["Keyboard Keys", 45], ["Hinge", 17], ["Mainboard", 16], ["NPU", 13], ["Replacement", 10], ["Other", 9], ["NPF", 8], ["Touchpad", 8]], "CBUS1100015": [["Keyboard", 708], ["Panel", 389], ["Camera", 355], ["Plastics", 159], ["Hinge", 136], ["Other", 108], ["NPU", 98], ["Keyboard Keys", 93], ["Mainboard", 80], ["NPF", 77]], "CBUS1100016": [["Keyboard", 172], ["Panel", 130], ["Keyboard Keys", 79], ["NPU", 75], ["Hinge", 68], ["Mainboard", 54], ["Other", 38], ["NPF", 32], ["Camera", 29], ["Plastics", 29]], "CBUS1100017": [["Keyboard", 826], ["Panel", 735], ["Keyboard Keys", 600], ["Mainboard", 358], ["NPU", 307], ["Plastics", 243], ["Daughterboard", 231], ["NPF", 164], ["Other", 118], ["Hinge", 98]], "CBUS1100019": [["LTE Module", 11], ["Other", 4], ["LVDS", 1], ["Mainboard", 1]], "CBUS1100020": [["Panel", 1233], ["Hinge", 652], ["Keyboard", 243], ["Keyboard Keys", 154], ["Mainboard", 142], ["NPF", 99], ["LTE Module", 96], ["NPU", 95], ["Plastics", 65], ["Other", 44]], "CBUS1100021": [["Panel", 166], ["Keyboard Keys", 40], ["NPU", 38], ["Hinge", 37], ["Keyboard", 36], ["Mainboard", 15], ["Plastics", 15], ["Other", 8], ["NPF", 7], ["Camera", 6]], "CBUS1100022": [["Panel", 306], ["Keyboard", 134], ["Keyboard Keys", 127], ["NPU", 69], ["Mainboard", 64], ["Replacement", 62], ["NPF", 54], ["Other", 33], ["Plastics", 32], ["Touchpad", 24]], "CBUS1100024": [["Panel", 160], ["Keyboard Keys", 80], ["Keyboard", 73], ["Mainboard", 63], ["NPU", 37], ["Camera", 19], ["Plastics", 19], ["NPF", 14], ["LVDS", 13], ["OS Issue", 13]], "CBUS1100025": [["Keyboard Keys", 209], ["Panel", 143], ["Daughterboard", 112], ["Keyboard", 111], ["Mainboard", 108], ["NPU", 79], ["NPF", 64], ["Plastics", 29], ["Hinge", 19], ["Other", 13]], "CBUS1100026": [["Keyboard Keys", 81], ["Panel", 81], ["Mainboard", 45], ["Hinge", 29], ["Keyboard", 25], ["NPU", 13], ["Camera", 12], ["NPF", 9], ["Other", 7], ["Plastics", 7]], "CBUS1100027": [["Daughterboard", 19], ["Keyboard", 17], ["Panel", 15], ["NPF", 11], ["Mainboard", 8], ["Camera", 6], ["Keyboard Keys", 6], ["NPU", 6], ["Hinge", 3], ["Replacement", 3]], "CBUS1100028": [["Panel", 31], ["Mainboard", 18], ["Declined", 11], ["Keyboard Keys", 11], ["Other", 11], ["Keyboard", 8], ["LVDS", 5], ["Camera", 4], ["Hinge", 4], ["NPF", 4]], "CBUS1100033": [["Replacement", 87], ["Panel", 28], ["Keyboard Keys", 16], ["Keyboard", 15], ["Mainboard", 12], ["NPF", 8], ["NPU", 8], ["Hinge", 3], ["Other", 3], ["Battery", 2]], "CBUS1100034": [["Panel", 40], ["Replacement", 23], ["Mainboard", 16], ["NPU", 16], ["Keyboard", 11], ["Keyboard Keys", 9], ["NPF", 8], ["Battery", 3], ["Hinge", 3], ["LVDS", 3]], "CBUS1100035": [["Plastics", 2], ["NPF", 2], ["Camera", 1], ["Headphone Port", 1], ["Keyboard", 1], ["LVDS", 1], ["Keyboard Keys", 1], ["NPU", 1], ["Replacement", 1]], "CBUS1100037": [["Panel", 5], ["Replacement", 3], ["Keyboard", 2], ["NPF", 1]], "CBUS1400002": [["Panel", 544], ["Keyboard", 288], ["Mainboard", 218], ["NPF", 210], ["NPU", 207], ["Declined", 116], ["Battery", 96], ["Touchpad", 78], ["Plastics", 73], ["Keyboard Keys", 60]], "CBUS1400003": [["Panel", 552], ["Keyboard", 225], ["Keyboard Keys", 124], ["Mainboard", 82], ["NPU", 47], ["NPF", 27], ["Declined", 24], ["Plastics", 15], ["Touchpad", 13], ["Other", 11]], "CBUS1400004": [["Panel", 35], ["Mainboard", 29], ["Keyboard Keys", 22], ["NPF", 21], ["Keyboard", 17], ["NPU", 13], ["Touchpad", 8], ["Daughterboard", 4], ["Declined", 4], ["Other", 4]], "CBUS1400005": [["Panel", 100], ["Keyboard", 36], ["NPF", 29], ["Other", 22], ["Mainboard", 21], ["Replacement", 17], ["Keyboard Keys", 15], ["NPU", 13], ["Plastics", 8], ["Touchpad", 8]], "CBUS1400007": [["NPF", 7], ["Panel", 7], ["Mainboard", 5], ["Other", 2], ["Plastics", 2], ["Battery", 1], ["Daughterboard", 1], ["Declined", 1], ["Keyboard", 1], ["LVDS", 1]], "CBUS1400009": [["Panel", 15], ["NPF", 10], ["Keyboard", 5], ["Keyboard Keys", 4], ["Mainboard", 4], ["NPU", 4], ["Battery", 1], ["Daughterboard", 1], ["LVDS", 1], ["Plastics", 1]], "CBUS1400011": [["Panel", 76], ["Replacement", 16], ["Keyboard", 8], ["NPF", 8], ["Keyboard Keys", 6], ["NPU", 5], ["Touchpad", 4], ["Daughterboard", 3], ["Other", 3], ["Hinge", 2]], "CBUS1400012": [["Replacement", 8], ["Panel", 7], ["Keyboard Keys", 4], ["Touchpad", 3], ["Other", 2], ["Battery", 1], ["Declined", 1], ["NPU", 1], ["Keyboard", 1], ["NPF", 1]], "CBUS1400013": [["Replacement", 3], ["Panel", 2], ["Keyboard Keys", 1], ["Battery", 1], ["NPU", 1], ["Tear Down", 1]], "CBUS1400015": [["Replacement", 7], ["Panel", 6], ["NPF", 5], ["Other", 3], ["NPU", 2], ["Keyboard", 1], ["Battery", 1], ["OS Issue", 1]], "CBXUS190003": [["Mainboard", 13], ["Other", 5], ["OS Issue", 3], ["NPF", 2], ["LVDS", 1], ["Wifi Module", 1]], "CBXUS190004": [["Mainboard", 3], ["Other", 2], ["NPF", 1], ["Replacement", 1]], "CBXUS190005": [["Other", 60], ["Mainboard", 50], ["Tear Down", 15], ["OS Issue", 11], ["NPF", 6], ["Wifi Module", 1]], "CBXUS190010": [["Other", 17], ["Replacement", 5], ["Mainboard", 4], ["OS Issue", 3], ["NPF", 2], ["Camera", 1], ["Storage", 1]], "CBXUS190011": [["Other", 4], ["NPF", 2], ["Replacement", 2], ["Storage", 2], ["OS Issue", 1]], "CBXUS190020": [["Mainboard", 27], ["Other", 18], ["Tear Down", 9], ["NPF", 6], ["OS Issue", 6], ["Storage", 6]], "NBCTX1": [["Panel", 10], ["NPU", 3], ["NPF", 3], ["Other", 2], ["Mainboard", 1]], "ZDPNL71CTL": [["NPU", 9], ["Panel", 4], ["Mainboard", 3], ["NPF", 2], ["Battery", 1], ["Daughterboard", 1], ["Declined", 1], ["Keyboard", 1], ["Other", 1], ["Touchpad", 1]]},
            overallTop10: [["Keyboard", 9906], ["Panel", 8564], ["NPU", 8532], ["Mainboard", 8482], ["Keyboard Keys", 5373], ["Battery", 4196], ["Hinge", 2561], ["NPF", 2486], ["Other", 1498], ["Daughterboard", 1343]],
            accidentalTop10: [["Panel", 6311], ["Keyboard", 5714], ["Keyboard Keys", 2781], ["Mainboard", 2067], ["Hinge", 1369], ["Plastics", 970], ["Other", 500], ["NPU", 445], ["Daughterboard", 402], ["Declined", 286]],
            nonAccidentalTop10: [["NPU", 8087], ["Mainboard", 6415], ["Keyboard", 4192], ["Battery", 3978], ["Keyboard Keys", 2592], ["NPF", 2475], ["Panel", 2253], ["Hinge", 1192], ["Other", 998], ["Daughterboard", 941]],
            inWarrantyTop10: [["NPU", 7897], ["Panel", 7748], ["Keyboard", 7353], ["Mainboard", 6627], ["Keyboard Keys", 4793], ["Battery", 3099], ["NPF", 2217], ["Hinge", 1976], ["Other", 1266], ["Daughterboard", 1188]],
            outWarrantyTop10: [["Keyboard", 2389], ["Mainboard", 1841], ["Battery", 1095], ["Panel", 776], ["NPU", 623], ["Hinge", 581], ["Keyboard Keys", 566], ["Declined", 386], ["Plastics", 368], ["Camera", 268]],
            majorTop10: [["Panel", 8564], ["Mainboard", 8482], ["Battery", 4196], ["Replacement", 517], ["Accidental", 103], ["Storage", 9]],
            minorTop10: [["Keyboard", 9906], ["Keyboard Keys", 5373], ["Hinge", 2561], ["Other", 1498], ["Daughterboard", 1343], ["Plastics", 1243], ["Wifi Module", 882], ["Camera", 831], ["Touchpad", 792], ["LVDS", 339]],
            npuTop10: [["NPU", 8532], ["NPF", 2486]]
        };
        
        // Password check function
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            const correctPassword = 'CTLdata20232026';
            
            if (password === correctPassword) {
                document.getElementById('passwordOverlay').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                initDashboard();
            } else {
                document.getElementById('passwordError').style.display = 'block';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }
        
        // Modal functions
        function openModal(itemNumber) {
            const data = dataByItem[itemNumber];
            if (!data) return;
            
            document.getElementById('modalTitle').textContent = data.model;
            document.getElementById('modalItemNumber').textContent = `Item #: ${data.item}`;
            
            // Stats grid
            document.getElementById('modalStatsGrid').innerHTML = `
                <div class="modal-stat">
                    <div class="modal-stat-value">${data.sold.toLocaleString()}</div>
                    <div class="modal-stat-label">Units Sold</div>
                </div>
                <div class="modal-stat">
                    <div class="modal-stat-value warning">${data.total.toLocaleString()}</div>
                    <div class="modal-stat-label">Total Repairs</div>
                </div>
                <div class="modal-stat">
                    <div class="modal-stat-value ${parseFloat(data.repairRate) > 10 ? 'danger' : parseFloat(data.repairRate) > 5 ? 'warning' : 'success'}">${data.repairRate}%</div>
                    <div class="modal-stat-label">Repair Rate</div>
                </div>
                <div class="modal-stat">
                    <div class="modal-stat-value warning">$${data.totalCost.toLocaleString()}</div>
                    <div class="modal-stat-label">Est. Total Cost</div>
                </div>
                <div class="modal-stat">
                    <div class="modal-stat-value purple">${data.accidentalPct}%</div>
                    <div class="modal-stat-label">Accidental %</div>
                </div>
                <div class="modal-stat">
                    <div class="modal-stat-value success">${data.inWarrantyPct}%</div>
                    <div class="modal-stat-label">In Warranty %</div>
                </div>
            `;
            
            // Repair breakdown
            document.getElementById('modalRepairBreakdown').innerHTML = `
                <div class="breakdown-item">
                    <div class="breakdown-value">${data.major.toLocaleString()}</div>
                    <div class="breakdown-label">Major Repairs</div>
                    <div class="breakdown-cost">$${(data.major * 100).toLocaleString()}</div>
                </div>
                <div class="breakdown-item">
                    <div class="breakdown-value">${data.minor.toLocaleString()}</div>
                    <div class="breakdown-label">Minor Repairs</div>
                    <div class="breakdown-cost">$${(data.minor * 50).toLocaleString()}</div>
                </div>
                <div class="breakdown-item">
                    <div class="breakdown-value">${data.npu.toLocaleString()}</div>
                    <div class="breakdown-label">NPU/NPF</div>
                    <div class="breakdown-cost">$${(data.npu * 20).toLocaleString()}</div>
                </div>
            `;
            
            // Accidental bar
            document.getElementById('modalAccidentalBar').style.width = data.accidentalPct + '%';
            document.getElementById('modalAccidentalPct').textContent = `Accidental: ${data.accidentalPct}%`;
            
            // Warranty bar
            document.getElementById('modalWarrantyBar').style.width = data.inWarrantyPct + '%';
            document.getElementById('modalInWarrantyPct').textContent = `In Warranty: ${data.inWarrantyPct}%`;
            document.getElementById('modalOutWarrantyPct').textContent = `Out: ${data.outWarrantyPct}%`;
            
            // Repair rate bar (scale to max 25%)
            const repairRateScaled = Math.min(parseFloat(data.repairRate) / 25 * 100, 100);
            document.getElementById('modalRepairRateBar').style.width = repairRateScaled + '%';
            document.getElementById('modalRepairRatePct').textContent = `This Model: ${data.repairRate}%`;
            
            // Repair categories table
            const modelRepairData = repairCategories.modelRepairs[itemNumber] || [];
            const totalModelRepairs = modelRepairData.reduce((sum, r) => sum + r[1], 0);
            document.getElementById('modalRepairCategoriesTable').innerHTML = modelRepairData.map(r => {
                const pct = totalModelRepairs > 0 ? ((r[1] / totalModelRepairs) * 100).toFixed(1) : 0;
                return `<tr><td>${r[0]}</td><td>${r[1].toLocaleString()}</td><td>${pct}%</td></tr>`;
            }).join('');
            
            document.getElementById('modelModal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('modelModal').classList.remove('active');
        }
        
        // Close modal on overlay click
        document.getElementById('modelModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        
        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
                closePieModal();
            }
        });
        
        // Pie Chart Modal functions
        function openPieModal(type, index) {
            let title, subtitle, summaryHTML, tableHeadHTML, tableBodyHTML, repairCategoriesData;
            
            if (type === 'repairType') {
                // Accidental vs Non-Accidental
                const isAccidental = index === 0;
                title = isAccidental ? 'üí• Accidental Damage Repairs' : 'üîß Non-Accidental Repairs';
                subtitle = isAccidental ? 'Breakdown by model for accidental damage repairs' : 'Breakdown by model for non-accidental repairs';
                
                // Get repair categories for this segment
                repairCategoriesData = isAccidental ? repairCategories.accidentalTop10 : repairCategories.nonAccidentalTop10;
                
                const sorted = [...warrantyData].sort((a, b) => {
                    const aVal = isAccidental ? a.accidental : (a.total - a.accidental);
                    const bVal = isAccidental ? b.accidental : (b.total - b.accidental);
                    return bVal - aVal;
                });
                
                const totalValue = sorted.reduce((sum, d) => sum + (isAccidental ? d.accidental : (d.total - d.accidental)), 0);
                const totalRepairsAll = sorted.reduce((sum, d) => sum + d.total, 0);
                const pctOfTotal = ((totalValue / totalRepairsAll) * 100).toFixed(1);
                
                summaryHTML = `
                    <div class="pie-summary-stat">
                        <div class="pie-summary-value ${isAccidental ? 'purple' : ''}">${totalValue.toLocaleString()}</div>
                        <div class="pie-summary-label">${isAccidental ? 'Accidental' : 'Non-Accidental'} Repairs</div>
                    </div>
                    <div class="pie-summary-stat">
                        <div class="pie-summary-value">${pctOfTotal}%</div>
                        <div class="pie-summary-label">of All Repairs</div>
                    </div>
                    <div class="pie-summary-stat">
                        <div class="pie-summary-value">${sorted.filter(d => (isAccidental ? d.accidental : (d.total - d.accidental)) > 0).length}</div>
                        <div class="pie-summary-label">Models Affected</div>
                    </div>
                `;
                
                tableHeadHTML = `<tr><th>Model</th><th>${isAccidental ? 'Accidental' : 'Non-Accidental'}</th><th>Total Repairs</th><th>% of Category</th></tr>`;
                tableBodyHTML = sorted.slice(0, 15).map(d => {
                    const value = isAccidental ? d.accidental : (d.total - d.accidental);
                    const pct = totalValue > 0 ? ((value / totalValue) * 100).toFixed(1) : 0;
                    return `<tr onclick="closePieModal(); openModal('${d.item}')">
                        <td>${d.shortName}</td>
                        <td>${value.toLocaleString()}</td>
                        <td>${d.total.toLocaleString()}</td>
                        <td>${pct}%</td>
                    </tr>`;
                }).join('');
                
            } else if (type === 'costBreakdown') {
                // Major, Minor, NPU/NPF
                const labels = ['Major Repairs ($100 each)', 'Minor Repairs ($50 each)', 'NPU/NPF ($20 each)'];
                const colors = ['red', 'orange', ''];
                const fields = ['major', 'minor', 'npu'];
                const costs = [100, 50, 20];
                
                title = ['üî¥ ' + labels[0], 'üü† ' + labels[1], 'üîµ ' + labels[2]][index];
                subtitle = 'Breakdown by model for this repair category';
                
                // Get repair categories for this segment
                repairCategoriesData = [repairCategories.majorTop10, repairCategories.minorTop10, repairCategories.npuTop10][index];
                
                const field = fields[index];
                const costPer = costs[index];
                const sorted = [...warrantyData].sort((a, b) => b[field] - a[field]);
                
                const totalCount = sorted.reduce((sum, d) => sum + d[field], 0);
                const totalCostCat = totalCount * costPer;
                const totalCostAll = sorted.reduce((sum, d) => sum + d.totalCost, 0);
                const pctOfCost = ((totalCostCat / totalCostAll) * 100).toFixed(1);
                
                summaryHTML = `
                    <div class="pie-summary-stat">
                        <div class="pie-summary-value ${colors[index]}">${totalCount.toLocaleString()}</div>
                        <div class="pie-summary-label">Total ${['Major', 'Minor', 'NPU/NPF'][index]} Repairs</div>
                    </div>
                    <div class="pie-summary-stat">
                        <div class="pie-summary-value orange">$${totalCostCat.toLocaleString()}</div>
                        <div class="pie-summary-label">Total Cost</div>
                    </div>
                    <div class="pie-summary-stat">
                        <div class="pie-summary-value">${pctOfCost}%</div>
                        <div class="pie-summary-label">of All Repair Costs</div>
                    </div>
                `;
                
                tableHeadHTML = `<tr><th>Model</th><th>Count</th><th>Cost</th><th>% of Category</th></tr>`;
                tableBodyHTML = sorted.slice(0, 15).map(d => {
                    const value = d[field];
                    const cost = value * costPer;
                    const pct = totalCount > 0 ? ((value / totalCount) * 100).toFixed(1) : 0;
                    return `<tr onclick="closePieModal(); openModal('${d.item}')">
                        <td>${d.shortName}</td>
                        <td>${value.toLocaleString()}</td>
                        <td>$${cost.toLocaleString()}</td>
                        <td>${pct}%</td>
                    </tr>`;
                }).join('');
                
            } else if (type === 'warrantyStatus') {
                // In Warranty vs Out of Warranty
                const isInWarranty = index === 0;
                title = isInWarranty ? '‚úÖ In Warranty Repairs' : '‚ùå Out of Warranty Repairs';
                subtitle = isInWarranty ? 'Repairs performed while device was under warranty' : 'Repairs performed after warranty expired';
                
                // Get repair categories for this segment
                repairCategoriesData = isInWarranty ? repairCategories.inWarrantyTop10 : repairCategories.outWarrantyTop10;
                
                const field = isInWarranty ? 'inWarranty' : 'outWarranty';
                const sorted = [...warrantyData].sort((a, b) => b[field] - a[field]);
                
                const totalValue = sorted.reduce((sum, d) => sum + d[field], 0);
                const totalBoth = sorted.reduce((sum, d) => sum + d.inWarranty + d.outWarranty, 0);
                const pctOfTotal = ((totalValue / totalBoth) * 100).toFixed(1);
                
                summaryHTML = `
                    <div class="pie-summary-stat">
                        <div class="pie-summary-value ${isInWarranty ? 'green' : 'red'}">${totalValue.toLocaleString()}</div>
                        <div class="pie-summary-label">${isInWarranty ? 'In' : 'Out of'} Warranty Repairs</div>
                    </div>
                    <div class="pie-summary-stat">
                        <div class="pie-summary-value">${pctOfTotal}%</div>
                        <div class="pie-summary-label">of All Repairs</div>
                    </div>
                    <div class="pie-summary-stat">
                        <div class="pie-summary-value">${sorted.filter(d => d[field] > 0).length}</div>
                        <div class="pie-summary-label">Models with ${isInWarranty ? 'In' : 'Out of'} Warranty</div>
                    </div>
                `;
                
                tableHeadHTML = `<tr><th>Model</th><th>${isInWarranty ? 'In Warranty' : 'Out of Warranty'}</th><th>Total W/ Status</th><th>% of Category</th></tr>`;
                tableBodyHTML = sorted.slice(0, 15).map(d => {
                    const value = d[field];
                    const pct = totalValue > 0 ? ((value / totalValue) * 100).toFixed(1) : 0;
                    return `<tr onclick="closePieModal(); openModal('${d.item}')">
                        <td>${d.shortName}</td>
                        <td>${value.toLocaleString()}</td>
                        <td>${(d.inWarranty + d.outWarranty).toLocaleString()}</td>
                        <td>${pct}%</td>
                    </tr>`;
                }).join('');
            }
            
            document.getElementById('pieModalTitle').textContent = title;
            document.getElementById('pieModalSubtitle').textContent = subtitle;
            document.getElementById('pieModalSummary').innerHTML = summaryHTML;
            document.getElementById('pieModalTableHead').innerHTML = tableHeadHTML;
            document.getElementById('pieModalTableBody').innerHTML = tableBodyHTML;
            
            // Populate repair categories table
            const totalRepairCatCount = repairCategoriesData.reduce((sum, r) => sum + r[1], 0);
            document.getElementById('pieModalRepairCategories').innerHTML = repairCategoriesData.map(r => {
                const pct = totalRepairCatCount > 0 ? ((r[1] / totalRepairCatCount) * 100).toFixed(1) : 0;
                return `<tr><td>${r[0]}</td><td>${r[1].toLocaleString()}</td><td>${pct}%</td></tr>`;
            }).join('');
            
            document.getElementById('pieModal').classList.add('active');
        }
        
        function closePieModal() {
            document.getElementById('pieModal').classList.remove('active');
        }
        
        // Close pie modal on overlay click
        document.getElementById('pieModal').addEventListener('click', function(e) {
            if (e.target === this) closePieModal();
        });
        
        function initDashboard() {
            // Model data - filtered for >1000 units, INCLUDING NL71/NL81
            // IMPORTANT: Only includes repairs with Order Received Date (completed repairs)
            warrantyData = [
                { model: "CTL Chromebook NL71TWB 8/64", item: "CBUS1100007", sold: 43456, major: 9408, minor: 9452, npu: 6584, accidental: 6156, total: 25444, inWarranty: 21033, outWarranty: 4406 },
                { model: "CTL Chromebook NL71TW 4/32", item: "CBUS1100003", sold: 18985, major: 1959, minor: 2410, npu: 779, accidental: 2014, total: 5148, inWarranty: 4922, outWarranty: 210 },
                { model: "CTL Chromebook NL72TW/8/64 CBU", item: "CBUS1100011", sold: 35388, major: 1183, minor: 2687, npu: 680, accidental: 1903, total: 4550, inWarranty: 4202, outWarranty: 313 },
                { model: "CTL Chromebook NL72T N4500 4/6", item: "CBUS1100017", sold: 37181, major: 1181, minor: 2553, npu: 471, accidental: 2200, total: 4205, inWarranty: 3527, outWarranty: 283 },
                { model: "CTL Chromebook NL72CT-L 4/64 L", item: "CBUS1100020", sold: 56259, major: 1423, minor: 1603, npu: 194, accidental: 1624, total: 3220, inWarranty: 3015, outWarranty: 112 },
                { model: "CTL Chromebook NL72 N5100 8/64", item: "CBUS1100015", sold: 23614, major: 499, minor: 1686, npu: 175, accidental: 940, total: 2360, inWarranty: 1425, outWarranty: 914 },
                { model: "CTL Chromebook NL81T 14\" FHD-T", item: "CBUS1400002", sold: 10817, major: 873, minor: 819, npu: 417, accidental: 1162, total: 2109, inWarranty: 1576, outWarranty: 531 },
                { model: "CTL Chromebook NL71 4/32", item: "CBUS1100001", sold: 59977, major: 690, minor: 629, npu: 337, accidental: 405, total: 1656, inWarranty: 573, outWarranty: 1077 },
                { model: "CTL Chromebook PX14E 14\" HD", item: "CBUS1400003", sold: 6573, major: 650, minor: 453, npu: 74, accidental: 719, total: 1177, inWarranty: 1035, outWarranty: 141 },
                { model: "CTL Chromebook PX11E 4/32", item: "CBUS1100014", sold: 13940, major: 215, minor: 800, npu: 73, accidental: 684, total: 1088, inWarranty: 563, outWarranty: 501 },
                { model: "CTL Chromebook PX11E 4/64", item: "CBUS1100022", sold: 20981, major: 448, minor: 455, npu: 123, accidental: 462, total: 1026, inWarranty: 930, outWarranty: 46 },
                { model: "CTL Chromebook NL73TW N100 360", item: "CBUS1100025", sold: 35933, major: 270, minor: 598, npu: 143, accidental: 515, total: 1011, inWarranty: 931, outWarranty: 39 },
                { model: "CTL Chromebook NL71CT-L LTE 4/", item: "CBUS1100006", sold: 101515, major: 377, minor: 361, npu: 90, accidental: 345, total: 828, inWarranty: 257, outWarranty: 567 },
                { model: "CTL Chromebook NL72 4/64", item: "CBUS1100016", sold: 22714, major: 198, minor: 521, npu: 107, accidental: 373, total: 826, inWarranty: 649, outWarranty: 147 },
                { model: "CTL Chromebook NL71T 4/32", item: "CBUS1100002", sold: 38678, major: 299, minor: 378, npu: 141, accidental: 184, total: 818, inWarranty: 605, outWarranty: 212 },
                { model: "CTL Chromebook NL71CT 4/32", item: "CBUS1100005", sold: 21689, major: 167, minor: 322, npu: 203, accidental: 170, total: 692, inWarranty: 452, outWarranty: 238 },
                { model: "CTL Chromebook NL71-L LTE 4/32", item: "CBUS1100008", sold: 5401, major: 378, minor: 173, npu: 10, accidental: 265, total: 561, inWarranty: 414, outWarranty: 147 },
                { model: "CTL Chromebook NL73/8 N100 8/6", item: "CBUS1100024", sold: 24195, major: 231, minor: 270, npu: 51, accidental: 291, total: 552, inWarranty: 435, outWarranty: 103 },
                { model: "CTL Chromebook NL72CT CBUS1100", item: "CBUS1100021", sold: 2994, major: 185, minor: 161, npu: 45, accidental: 250, total: 391, inWarranty: 371, outWarranty: 18 },
                { model: "CTL Chromebook PX11E 4/32-180", item: "CBUS1100014A", sold: 1983, major: 154, minor: 200, npu: 21, accidental: 231, total: 375, inWarranty: 313, outWarranty: 54 },
                { model: "CTL Chromebook NL72-L 4/64 LTE", item: "CBUS1100013", sold: 1679, major: 83, minor: 236, npu: 33, accidental: 202, total: 352, inWarranty: 296, outWarranty: 49 },
                { model: "CTL Chromebook NL73CT N100 8/6", item: "CBUS1100026", sold: 13093, major: 134, minor: 187, npu: 22, accidental: 174, total: 343, inWarranty: 316, outWarranty: 27 },
                { model: "CTL Chromebook VX11 4/32", item: "CBUS1100004", sold: 15831, major: 48, minor: 255, npu: 20, accidental: 215, total: 323, inWarranty: 32, outWarranty: 290 },
                { model: "CTL Chromebook PX14EXT 14\" Tou", item: "CBUS1400005", sold: 2475, major: 150, minor: 116, npu: 42, accidental: 167, total: 308, inWarranty: 289, outWarranty: 8 },
                { model: "CTL Chromebook PX111E 4/64", item: "CBUS1100033", sold: 12330, major: 129, minor: 55, npu: 16, accidental: 76, total: 200, inWarranty: 191, outWarranty: 8 },
                { model: "CTL Chromebook PX14EX 14\" FHD", item: "CBUS1400004", sold: 3511, major: 70, minor: 73, npu: 34, accidental: 68, total: 177, inWarranty: 153, outWarranty: 19 },
                { model: "CTL Chromebook PX111E 8/64", item: "CBUS1100034", sold: 5509, major: 83, minor: 49, npu: 24, accidental: 52, total: 156, inWarranty: 150, outWarranty: 3 },
                { model: "CTL GOOGLE MEET GQE15C SYSTEM", item: "CBXUS190005", sold: 13042, major: 50, minor: 98, npu: 6, accidental: 0, total: 154, inWarranty: 140, outWarranty: 0 },
                { model: "CTL Chromebook PX141E N100 8/6", item: "CBUS1400011", sold: 10859, major: 93, minor: 43, npu: 13, accidental: 63, total: 149, inWarranty: 135, outWarranty: 14 },
                { model: "CTL Chromebook NL73 N100 4/64", item: "CBUS1100028", sold: 11992, major: 52, minor: 73, npu: 7, accidental: 45, total: 132, inWarranty: 100, outWarranty: 30 },
                { model: "CTL Chromebook NL73T N100 360", item: "CBUS1100027", sold: 3481, major: 28, minor: 69, npu: 17, accidental: 43, total: 114, inWarranty: 99, outWarranty: 6 },
                { model: "CTL Meet Compute System (GQE20C)", item: "CBXUS190020", sold: 6152, major: 33, minor: 43, npu: 6, accidental: 0, total: 82, inWarranty: 80, outWarranty: 0 },
                { model: "CTL PX14EXT 14\" TS 8/128-N6000", item: "CBUS1400009", sold: 1055, major: 20, minor: 17, npu: 14, accidental: 23, total: 51, inWarranty: 47, outWarranty: 2 },
                { model: "CTL PX14EXT 14\" TS 8/64-N6000", item: "CBUS1400007", sold: 1495, major: 14, minor: 15, npu: 8, accidental: 14, total: 37, inWarranty: 33, outWarranty: 1 },
                { model: "CTL Chromebox CBx3 Cel 7305 -", item: "CBXUS190010", sold: 7369, major: 10, minor: 23, npu: 2, accidental: 0, total: 35, inWarranty: 30, outWarranty: 0 },
                { model: "CTL Chromebook PX141EXT CBUS14", item: "CBUS1400012", sold: 5009, major: 16, minor: 14, npu: 2, accidental: 9, total: 32, inWarranty: 32, outWarranty: 0 },
                { model: "DP Consignment NL71CT-L Chrom", item: "ZDPNL71CTL", sold: 1992, major: 8, minor: 9, npu: 11, accidental: 6, total: 28, inWarranty: 21, outWarranty: 7 },
                { model: "CTL Chromebook PX141GXT CBUS14", item: "CBUS1400015", sold: 3062, major: 14, minor: 7, npu: 7, accidental: 7, total: 28, inWarranty: 26, outWarranty: 1 },
                { model: "CTL Chromebox CBx2 4/64 5205U", item: "CBXUS190003", sold: 15709, major: 13, minor: 10, npu: 2, accidental: 0, total: 25, inWarranty: 20, outWarranty: 0 },
                { model: "CTL Chrome Tablet Tx1 4GB / 32", item: "NBCTX1", sold: 4257, major: 11, minor: 2, npu: 6, accidental: 8, total: 19, inWarranty: 8, outWarranty: 11 },
                { model: "CTL Chromebook NL72-L 4/64 LTE", item: "CBUS1100019", sold: 7883, major: 1, minor: 16, npu: 0, accidental: 0, total: 17, inWarranty: 13, outWarranty: 0 },
                { model: "CTL NL73 CHROMEBOOK GEN2", item: "CBUS1100037", sold: 3632, major: 8, minor: 3, npu: 1, accidental: 8, total: 12, inWarranty: 11, outWarranty: 0 },
                { model: "CTL NL73TW CHROMEBOOK GEN2", item: "CBUS1100035", sold: 3346, major: 1, minor: 8, npu: 3, accidental: 3, total: 12, inWarranty: 12, outWarranty: 0 },
                { model: "CTL Chromebox CBx3-7 i7-1355U", item: "CBXUS190011", sold: 1016, major: 4, minor: 5, npu: 2, accidental: 0, total: 11, inWarranty: 11, outWarranty: 0 },
                { model: "CTL Chromebook PX141GX CBUS140", item: "CBUS1400013", sold: 1530, major: 6, minor: 2, npu: 1, accidental: 5, total: 9, inWarranty: 8, outWarranty: 1 },
                { model: "CTL Chromebox CBx2-7 8/128", item: "CBXUS190004", sold: 1420, major: 4, minor: 2, npu: 1, accidental: 0, total: 7, inWarranty: 5, outWarranty: 2 }
            ];
            
            // Calculate derived metrics and build lookup
            warrantyData.forEach(d => {
                d.repairRate = ((d.total / d.sold) * 100).toFixed(2);
                d.totalCost = (d.major * 100) + (d.minor * 50) + (d.npu * 20);
                d.accidentalPct = d.total > 0 ? ((d.accidental / d.total) * 100).toFixed(2) : "0.00";
                d.inWarrantyPct = (d.inWarranty + d.outWarranty) > 0 ? 
                    ((d.inWarranty / (d.inWarranty + d.outWarranty)) * 100).toFixed(2) : "0.00";
                d.outWarrantyPct = (d.inWarranty + d.outWarranty) > 0 ? 
                    ((d.outWarranty / (d.inWarranty + d.outWarranty)) * 100).toFixed(2) : "0.00";
                d.shortName = d.model.replace('CTL Chromebook ', '').replace('CTL ', '').substring(0, 20);
                dataByItem[d.item] = d;
            });
            
            // Calculate totals
            const totalSold = warrantyData.reduce((sum, d) => sum + d.sold, 0);
            const totalRepairs = warrantyData.reduce((sum, d) => sum + d.total, 0);
            const totalMajor = warrantyData.reduce((sum, d) => sum + d.major, 0);
            const totalMinor = warrantyData.reduce((sum, d) => sum + d.minor, 0);
            const totalNPU = warrantyData.reduce((sum, d) => sum + d.npu, 0);
            const totalAccidental = warrantyData.reduce((sum, d) => sum + d.accidental, 0);
            const totalInWarranty = warrantyData.reduce((sum, d) => sum + d.inWarranty, 0);
            const totalOutWarranty = warrantyData.reduce((sum, d) => sum + d.outWarranty, 0);
            const totalCost = warrantyData.reduce((sum, d) => sum + d.totalCost, 0);
            
            // Update KPIs
            document.getElementById('kpiUnitsSold').textContent = totalSold.toLocaleString();
            document.getElementById('kpiTotalRepairs').textContent = totalRepairs.toLocaleString();
            document.getElementById('kpiRepairRate').textContent = ((totalRepairs / totalSold) * 100).toFixed(2) + '%';
            document.getElementById('kpiTotalCost').textContent = '$' + totalCost.toLocaleString();
            document.getElementById('kpiAccidental').textContent = ((totalAccidental / totalRepairs) * 100).toFixed(1) + '%';
            document.getElementById('kpiInWarranty').textContent = ((totalInWarranty / (totalInWarranty + totalOutWarranty)) * 100).toFixed(1) + '%';
            
            // Sort data for different views
            const byRepairRate = [...warrantyData].sort((a, b) => parseFloat(b.repairRate) - parseFloat(a.repairRate));
            const byReliable = [...warrantyData].sort((a, b) => parseFloat(a.repairRate) - parseFloat(b.repairRate));
            const byCost = [...warrantyData].sort((a, b) => b.totalCost - a.totalCost);
            const byAccidental = [...warrantyData].filter(d => d.total >= 100).sort((a, b) => parseFloat(b.accidentalPct) - parseFloat(a.accidentalPct));
            
            // Chart colors
            const redGradient = byRepairRate.map((_, i) => {
                const ratio = i / byRepairRate.length;
                return `rgba(${229 - ratio * 80}, ${115 + ratio * 80}, ${115 + ratio * 80}, 0.8)`;
            });
            
            const purpleGradient = byAccidental.slice(0, 15).map((_, i) => {
                const ratio = i / 15;
                return `rgba(${186 - ratio * 40}, ${104 + ratio * 40}, ${200 - ratio * 40}, 0.8)`;
            });
            
            // Chart click handler
            function createClickHandler(dataArray) {
                return function(event, elements) {
                    if (elements.length > 0) {
                        const index = elements[0].index;
                        const item = dataArray[index].item;
                        openModal(item);
                    }
                };
            }
            
            // Repair Rate Chart
            new Chart(document.getElementById('repairRateChart'), {
                type: 'bar',
                data: {
                    labels: byRepairRate.slice(0, 15).map(d => d.shortName),
                    datasets: [{
                        label: 'Repair Rate %',
                        data: byRepairRate.slice(0, 15).map(d => parseFloat(d.repairRate)),
                        backgroundColor: redGradient.slice(0, 15),
                        borderColor: redGradient.slice(0, 15),
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: createClickHandler(byRepairRate.slice(0, 15)),
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const d = byRepairRate[context.dataIndex];
                                    return `Sold: ${d.sold.toLocaleString()} | Repairs: ${d.total.toLocaleString()}\nClick for details`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Repair Rate (%)', color: '#90a4ae' },
                            ticks: { color: '#90a4ae' },
                            grid: { color: 'rgba(79, 195, 247, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#e4e4e4', font: { size: 11 } },
                            grid: { display: false }
                        }
                    }
                }
            });
            
            // Cost by Model Chart
            new Chart(document.getElementById('costByModelChart'), {
                type: 'bar',
                data: {
                    labels: byCost.slice(0, 15).map(d => d.shortName),
                    datasets: [{
                        label: 'Total Cost ($)',
                        data: byCost.slice(0, 15).map(d => d.totalCost),
                        backgroundColor: '#ffb74d',
                        borderColor: '#ff9800',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: createClickHandler(byCost.slice(0, 15)),
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Cost: $' + context.raw.toLocaleString();
                                },
                                afterLabel: function() {
                                    return 'Click for details';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Total Repair Cost ($)', color: '#90a4ae' },
                            ticks: { 
                                color: '#90a4ae',
                                callback: value => '$' + (value/1000).toFixed(0) + 'K'
                            },
                            grid: { color: 'rgba(79, 195, 247, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#e4e4e4', font: { size: 11 } },
                            grid: { display: false }
                        }
                    }
                }
            });
            
            // Repair Type Distribution
            new Chart(document.getElementById('repairTypeChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Accidental Damage', 'Non-Accidental'],
                    datasets: [{
                        data: [totalAccidental, totalRepairs - totalAccidental],
                        backgroundColor: ['#ba68c8', '#4fc3f7'],
                        borderColor: '#1a2d47',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: function(event, elements) {
                        if (elements.length > 0) {
                            openPieModal('repairType', elements[0].index);
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#e4e4e4', padding: 15 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const percentage = ((value / totalRepairs) * 100).toFixed(1);
                                    return `${context.label}: ${value.toLocaleString()} (${percentage}%)`;
                                },
                                afterLabel: function() {
                                    return 'Click for model breakdown';
                                }
                            }
                        }
                    }
                }
            });
            
            // Cost Distribution
            const majorCost = totalMajor * 100;
            const minorCost = totalMinor * 50;
            const npuCost = totalNPU * 20;
            
            new Chart(document.getElementById('costChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Major ($100)', 'Minor ($50)', 'NPU/NPF ($20)'],
                    datasets: [{
                        data: [majorCost, minorCost, npuCost],
                        backgroundColor: ['#e57373', '#ffb74d', '#4fc3f7'],
                        borderColor: '#1a2d47',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: function(event, elements) {
                        if (elements.length > 0) {
                            openPieModal('costBreakdown', elements[0].index);
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#e4e4e4', padding: 15 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': $' + context.raw.toLocaleString();
                                },
                                afterLabel: function() {
                                    return 'Click for model breakdown';
                                }
                            }
                        }
                    }
                }
            });
            
            // Accidental Damage Chart
            new Chart(document.getElementById('accidentalChart'), {
                type: 'bar',
                data: {
                    labels: byAccidental.slice(0, 15).map(d => d.shortName),
                    datasets: [{
                        label: 'Accidental %',
                        data: byAccidental.slice(0, 15).map(d => parseFloat(d.accidentalPct)),
                        backgroundColor: purpleGradient,
                        borderColor: purpleGradient,
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: createClickHandler(byAccidental.slice(0, 15)),
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                afterLabel: function() {
                                    return 'Click for details';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Accidental Damage % of Repairs', color: '#90a4ae' },
                            ticks: { color: '#90a4ae' },
                            grid: { color: 'rgba(79, 195, 247, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#e4e4e4', font: { size: 11 } },
                            grid: { display: false }
                        }
                    }
                }
            });
            
            // Warranty Status Chart
            new Chart(document.getElementById('warrantyChart'), {
                type: 'doughnut',
                data: {
                    labels: ['In Warranty', 'Out of Warranty'],
                    datasets: [{
                        data: [totalInWarranty, totalOutWarranty],
                        backgroundColor: ['#81c784', '#e57373'],
                        borderColor: '#1a2d47',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: function(event, elements) {
                        if (elements.length > 0) {
                            openPieModal('warrantyStatus', elements[0].index);
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#e4e4e4', padding: 15 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const total = totalInWarranty + totalOutWarranty;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: ${value.toLocaleString()} (${percentage}%)`;
                                },
                                afterLabel: function() {
                                    return 'Click for model breakdown';
                                }
                            }
                        }
                    }
                }
            });
            
            // Accidental Damage Cost by Model Chart (100+ repairs only)
            const byAccidentalCost = [...warrantyData]
                .filter(d => d.total >= 100)
                .map(d => {
                    const avgCostPerRepair = d.totalCost / d.total;
                    const accidentalCost = Math.round(d.accidental * avgCostPerRepair);
                    return { ...d, accidentalCost };
                })
                .sort((a, b) => b.accidentalCost - a.accidentalCost);
            
            const accidentalCostGradient = byAccidentalCost.slice(0, 15).map((_, i) => {
                const intensity = 1 - (i / 15) * 0.5;
                return `rgba(186, 104, 200, ${intensity})`;
            });
            
            new Chart(document.getElementById('accidentalCostChart'), {
                type: 'bar',
                data: {
                    labels: byAccidentalCost.slice(0, 15).map(d => d.shortName),
                    datasets: [{
                        label: 'Accidental Damage Cost ($)',
                        data: byAccidentalCost.slice(0, 15).map(d => d.accidentalCost),
                        backgroundColor: accidentalCostGradient,
                        borderColor: accidentalCostGradient.map(c => c.replace('0.', '1.')),
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: createClickHandler(byAccidentalCost.slice(0, 15)),
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Est. Cost: $${context.raw.toLocaleString()}`;
                                },
                                afterLabel: function(context) {
                                    const d = byAccidentalCost[context.dataIndex];
                                    return `Accidental Repairs: ${d.accidental.toLocaleString()}\nClick for model details`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { 
                                color: '#b0b0b0',
                                callback: function(value) {
                                    return '$' + (value / 1000).toFixed(0) + 'K';
                                }
                            },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            ticks: { color: '#e4e4e4', font: { size: 10 } },
                            grid: { display: false }
                        }
                    }
                }
            });
            
            // Warranty Cost Breakdown Chart
            const totalInWarrantyCost = warrantyData.reduce((sum, d) => {
                const avgCostPerRepair = d.total > 0 ? d.totalCost / d.total : 0;
                return sum + Math.round(d.inWarranty * avgCostPerRepair);
            }, 0);
            const totalOutWarrantyCost = warrantyData.reduce((sum, d) => {
                const avgCostPerRepair = d.total > 0 ? d.totalCost / d.total : 0;
                return sum + Math.round(d.outWarranty * avgCostPerRepair);
            }, 0);
            
            new Chart(document.getElementById('warrantyCostChart'), {
                type: 'doughnut',
                data: {
                    labels: ['In Warranty', 'Out of Warranty'],
                    datasets: [{
                        data: [totalInWarrantyCost, totalOutWarrantyCost],
                        backgroundColor: ['#81c784', '#e57373'],
                        borderColor: '#1a2d47',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#e4e4e4', padding: 15 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const total = totalInWarrantyCost + totalOutWarrantyCost;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: $${value.toLocaleString()} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Generate Insights
            const insights = [
                {
                    icon: '‚ö†Ô∏è',
                    title: `Highest Repair Rate: ${byRepairRate[0].model}`,
                    text: `At ${byRepairRate[0].repairRate}% repair rate with ${byRepairRate[0].total.toLocaleString()} repairs from ${byRepairRate[0].sold.toLocaleString()} units sold. This model requires attention for quality improvement.`
                },
                {
                    icon: '‚úÖ',
                    title: `Most Reliable: ${byReliable[0].model}`,
                    text: `Only ${byReliable[0].repairRate}% repair rate with just ${byReliable[0].total.toLocaleString()} repairs from ${byReliable[0].sold.toLocaleString()} units sold. Excellent reliability performance.`
                },
                {
                    icon: 'üí∞',
                    title: `Highest Repair Cost: ${byCost[0].model}`,
                    text: `Estimated total repair cost of $${byCost[0].totalCost.toLocaleString()} with ${byCost[0].major.toLocaleString()} major, ${byCost[0].minor.toLocaleString()} minor, and ${byCost[0].npu.toLocaleString()} NPU/NPF repairs.`
                },
                {
                    icon: 'üí•',
                    title: `Accidental Damage Analysis`,
                    text: `${((totalAccidental / totalRepairs) * 100).toFixed(1)}% of all repairs are classified as accidental damage (${totalAccidental.toLocaleString()} of ${totalRepairs.toLocaleString()} total repairs). VX11 has highest at ${byAccidental[0].accidentalPct}%.`
                },
                {
                    icon: 'üìã',
                    title: `Warranty Status Overview`,
                    text: `${((totalInWarranty / (totalInWarranty + totalOutWarranty)) * 100).toFixed(1)}% of repairs occur while devices are still in warranty (${totalInWarranty.toLocaleString()} in warranty vs ${totalOutWarranty.toLocaleString()} out of warranty).`
                },
                {
                    icon: 'üìä',
                    title: `Cost Breakdown Summary`,
                    text: `Major repairs: $${majorCost.toLocaleString()} (${((majorCost / totalCost) * 100).toFixed(1)}%), Minor repairs: $${minorCost.toLocaleString()} (${((minorCost / totalCost) * 100).toFixed(1)}%), NPU/NPF: $${npuCost.toLocaleString()} (${((npuCost / totalCost) * 100).toFixed(1)}%).`
                },
                {
                    icon: 'üèÜ',
                    title: `Gen2 Models Performing Well`,
                    text: `The newer NL73TW Gen2 and NL73 Gen2 models show excellent reliability with repair rates under 0.5%. Early indicators suggest improved build quality.`
                }
            ];
            
            document.getElementById('insightsList').innerHTML = insights.map(i => `
                <div class="insight-item">
                    <div class="insight-icon">${i.icon}</div>
                    <div class="insight-text">
                        <h4>${i.title}</h4>
                        <p>${i.text}</p>
                    </div>
                </div>
            `).join('');
            
            // Populate Tables with click handlers
            function getRateBadge(rate) {
                rate = parseFloat(rate);
                if (rate > 10) return `<span class="badge badge-danger">${rate}%</span>`;
                if (rate > 5) return `<span class="badge badge-warning">${rate}%</span>`;
                return `<span class="badge badge-success">${rate}%</span>`;
            }
            
            function formatCurrency(val) {
                return '$' + val.toLocaleString();
            }
            
            // Worst table (highest repair rate)
            document.getElementById('worstTable').innerHTML = byRepairRate.slice(0, 15).map(d => `
                <tr onclick="openModal('${d.item}')">
                    <td>${d.model}</td>
                    <td>${d.item}</td>
                    <td>${d.sold.toLocaleString()}</td>
                    <td>${d.total.toLocaleString()}</td>
                    <td>${getRateBadge(d.repairRate)}</td>
                    <td>${formatCurrency(d.totalCost)}</td>
                </tr>
            `).join('');
            
            // Best table (lowest repair rate)
            document.getElementById('bestTable').innerHTML = byReliable.slice(0, 15).map(d => `
                <tr onclick="openModal('${d.item}')">
                    <td>${d.model}</td>
                    <td>${d.item}</td>
                    <td>${d.sold.toLocaleString()}</td>
                    <td>${d.total.toLocaleString()}</td>
                    <td>${getRateBadge(d.repairRate)}</td>
                    <td>${formatCurrency(d.totalCost)}</td>
                </tr>
            `).join('');
            
            // Cost table
            document.getElementById('costTable').innerHTML = byCost.slice(0, 15).map(d => `
                <tr onclick="openModal('${d.item}')">
                    <td>${d.model}</td>
                    <td>${d.sold.toLocaleString()}</td>
                    <td>${d.total.toLocaleString()}</td>
                    <td>${getRateBadge(d.repairRate)}</td>
                    <td>${formatCurrency(d.totalCost)}</td>
                </tr>
            `).join('');
            
            // Accidental table
            document.getElementById('accidentalTable').innerHTML = byAccidental.slice(0, 15).map(d => `
                <tr onclick="openModal('${d.item}')">
                    <td>${d.model}</td>
                    <td>${d.accidental.toLocaleString()}</td>
                    <td>${d.total.toLocaleString()}</td>
                    <td>${d.accidentalPct}%</td>
                </tr>
            `).join('');
            
            // Warranty table
            const byWarranty = [...warrantyData].filter(d => (d.inWarranty + d.outWarranty) > 0)
                .sort((a, b) => parseFloat(b.outWarrantyPct) - parseFloat(a.outWarrantyPct));
            document.getElementById('warrantyTable').innerHTML = byWarranty.slice(0, 15).map(d => `
                <tr onclick="openModal('${d.item}')">
                    <td>${d.model}</td>
                    <td>${d.inWarranty.toLocaleString()}</td>
                    <td>${d.outWarranty.toLocaleString()}</td>
                    <td>${d.inWarrantyPct}%</td>
                    <td>${d.outWarrantyPct}%</td>
                </tr>
            `).join('');
            
            // All models table
            document.getElementById('allTable').innerHTML = warrantyData.sort((a,b) => b.totalCost - a.totalCost).map(d => `
                <tr onclick="openModal('${d.item}')">
                    <td>${d.model}</td>
                    <td>${d.item}</td>
                    <td>${d.sold.toLocaleString()}</td>
                    <td>${d.major}</td>
                    <td>${d.minor}</td>
                    <td>${d.npu}</td>
                    <td>${d.accidental}</td>
                    <td>${d.total}</td>
                    <td>${getRateBadge(d.repairRate)}</td>
                    <td>${formatCurrency(d.totalCost)}</td>
                </tr>
            `).join('');
        }
        
        // Tab functionality
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }
        
        // Focus password input on load
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('passwordInput').focus();
        });
    </script>
</body>
</html>
